<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIP Access - Pro Sports</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap');
        :root { --premium-purple: #7b61ff; --bg-dark: #050505; --card-glass: rgba(255, 255, 255, 0.03); --glow: rgba(123, 97, 255, 0.4); }
        body { background-color: var(--bg-dark); background-image: radial-gradient(circle at 50% 10%, #1a103d 0%, #050505 100%); color: white; font-family: 'Poppins', sans-serif; margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; padding: 90px 15px 30px; }
        .navbar { position: fixed; top: 0; left: 0; width: 100%; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(20px); border-bottom: 1px solid rgba(255, 255, 255, 0.1); padding: 15px 0; z-index: 1001; text-align: center; }
        .navbar h1 { font-size: 1.2rem; margin: 0; font-weight: 800; color: var(--premium-purple); text-shadow: 0 0 10px var(--glow); }
        .plan-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; width: 100%; max-width: 400px; }
        .plan-card { background: var(--card-glass); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 24px; padding: 20px 15px; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .plan-card:hover { border-color: var(--premium-purple); transform: translateY(-8px); box-shadow: 0 15px 35px rgba(0,0,0,0.6); }
        .price-box .amount { font-size: 1.8rem; font-weight: 800; color: #fff; display: block; }
        .buy-btn { background: linear-gradient(135deg, var(--premium-purple), #5a41e6); color: #fff; border: none; width: 100%; padding: 12px; border-radius: 14px; font-weight: 700; cursor: pointer; margin-bottom: 15px; font-size: 0.7rem; text-transform: uppercase; }
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(8px); display: none; justify-content: center; align-items: center; z-index: 2000; }
        .modal-content { background: #0f0f15; width: 85%; max-width: 340px; padding: 30px; border-radius: 28px; border: 1px solid rgba(123, 97, 255, 0.3); }
        .input-group input, .input-group select { width: 100%; padding: 14px; background: #050505; border: 1px solid #222; border-radius: 12px; color: white; margin-bottom: 15px; }
    </style>
</head>
<body>

    <div class="navbar">
        <h1>ðŸ‘‘ VIP PREDICTIONS</h1>
        <p id="geo-status" style="font-size: 0.65rem; color: #888;">Detecting region...</p>
    </div>

    <div id="plan-list" class="plan-grid"></div>

    <div id="pModal" class="modal">
        <div class="modal-content">
            <h3 style="margin:0 0 15px; text-align:center">Final Step</h3>
            <div id="adminInfo" style="background: rgba(123, 97, 255, 0.08); padding: 15px; border-radius: 15px; font-size: 0.8rem; margin-bottom: 20px; border: 1px dashed var(--premium-purple); text-align:center;"></div>
            
            <div class="input-group">
                <select id="mth" onchange="updateUI()"></select>
            </div>
            <div class="input-group">
                <input type="text" id="mInfo" placeholder="Your Wallet/Phone Address">
            </div>
            <div class="input-group">
                <input type="text" id="trxId" placeholder="Transaction ID (TrxID)">
            </div>
            <button class="buy-btn" id="sub-btn" onclick="submitOrder()">ACTIVATE NOW</button>
            <button style="background:none; border:none; color:#555; width:100%; font-size:0.7rem; cursor:pointer" onclick="closeModal()">Cancel</button>
        </div>
    </div>

    <script>
        const S_URL = 'https://cclfxvmpgkytzebuhwpj.supabase.co';
        const S_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNjbGZ4dm1wZ2t5dHplYnVod3BqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE5MDUyNTIsImV4cCI6MjA4NzQ4MTI1Mn0.-x_bxezKwaiJBdkTrJaXJuN95614sTHvTR3oBP_aLZQ';
        const _supabase = window.supabase.createClient(S_URL, S_KEY);

        const ADMIN_WALLETS = {
            bKash: "017XXXXXXXX (Personal)",
            Nagad: "018XXXXXXXX (Personal)",
            USDT: "T9zBxxxxxxxxxxxxxxxxx (TRC20)",
            ETH: "0xde0B295669a9FD93d5F28D9Ec85E40f4cb697BAe (ERC20)",
            SOL: "7xKXEcxxxxxxxxxxxxxxxxx (Solana)"
        };

        let selectedPlan = {};
        let isLocal = true;
        let userEmail = "guest@user.com";
        let liveRates = { ethereum: 0, solana: 0 };

        // à§§. à¦²à¦¾à¦‡à¦­ à¦•à§à¦°à¦¿à¦ªà§à¦Ÿà§‹ à¦ªà§à¦°à¦¾à¦‡à¦¸ à¦¨à¦¿à§Ÿà§‡ à¦†à¦¸à¦¾
        async function fetchLivePrices() {
            try {
                const res = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=ethereum,solana&vs_currencies=usd');
                const data = await res.json();
                liveRates.ethereum = data.ethereum.usd;
                liveRates.solana = data.solana.usd;
            } catch(e) { console.error("API Error: Using fallback rates"); }
        }

        async function initPage() {
            await fetchLivePrices();
            const { data: { session } } = await _supabase.auth.getSession();
            if (session) userEmail = session.user.email;

            try {
                const res = await fetch('https://ipapi.co/json/');
                const data = await res.json();
                isLocal = (data.country_code === 'BD');
                document.getElementById('geo-status').innerText = isLocal ? "Region: Bangladesh (à§³)" : "Region: International ($)";
            } catch(e) { isLocal = true; }
            loadPlans();
        }

        async function loadPlans() {
            const { data: plans } = await _supabase.from('subscription_plans').select('*').eq('is_active', true);
            document.getElementById('plan-list').innerHTML = plans.map(p => {
                const symbol = isLocal ? 'à§³' : '$';
                const price = isLocal ? p.price_bdt : p.price_usd;
                return `
                    <div class="plan-card">
                        <div class="price-box"><span class="amount">${symbol}${price}</span><span class="sub">${p.duration_days} Days Access</span></div>
                        <button class="buy-btn" onclick="openModal('${p.plan_name}', ${p.duration_days}, ${price})">GET VIP</button>
                    </div>`;
            }).join('');
        }

        function openModal(name, days, price) {
            selectedPlan = { name, days, price };
            const mth = document.getElementById('mth');
            mth.innerHTML = isLocal ? `<option value="bKash">bKash</option><option value="Nagad">Nagad</option>` : 
                `<option value="USDT">USDT (TRC20)</option><option value="ETH">Ethereum (ETH)</option><option value="SOL">Solana (SOL)</option>`;
            updateUI();
            document.getElementById('pModal').style.display = 'flex';
        }

        function updateUI() {
            const method = document.getElementById('mth').value;
            let finalDisplay = isLocal ? `à§³${selectedPlan.price}` : `$${selectedPlan.price}`;
            
            // à¦•à§à¦°à¦¿à¦ªà§à¦Ÿà§‹ à¦•à¦¨à¦­à¦¾à¦°à§à¦¸à¦¨ à¦²à¦œà¦¿à¦•
            if (!isLocal) {
                if (method === "ETH" && liveRates.ethereum > 0) {
                    finalDisplay = (selectedPlan.price / liveRates.ethereum).toFixed(5) + " ETH";
                } else if (method === "SOL" && liveRates.solana > 0) {
                    finalDisplay = (selectedPlan.price / liveRates.solana).toFixed(4) + " SOL";
                } else if (method === "USDT") {
                    finalDisplay = selectedPlan.price + " USDT";
                }
            }

            document.getElementById('adminInfo').innerHTML = `Send <b>${finalDisplay}</b> to:<br><span style="color:var(--premium-purple); word-break:break-all;">${ADMIN_WALLETS[method]}</span>`;
        }

        function closeModal() { document.getElementById('pModal').style.display = 'none'; }

        async function submitOrder() {
            const contact = document.getElementById('mInfo').value;
            const trx = document.getElementById('trxId').value;
            const btn = document.getElementById('sub-btn');
            if(!contact || !trx) { Swal.fire('Error', 'Missing details', 'error'); return; }

            btn.disabled = true; btn.innerText = "Processing...";

            const { error } = await _supabase.from('payment_requests').insert([{
                user_email: userEmail, mobile: contact, plan_name: selectedPlan.name,
                duration: selectedPlan.days, amount: document.getElementById('adminInfo').innerText.split('to:')[0].trim(),
                payment_method: document.getElementById('mth').value, currency: isLocal ? 'BDT' : 'CRYPTO',
                transaction_id: trx, status: 'pending'
            }]);

            if(!error) {
                Swal.fire('Success', 'Request sent! We will verify and activate.', 'success').then(() => location.reload());
            } else { Swal.fire('Error', error.message, 'error'); btn.disabled = false; }
        }

        initPage();
    </script>
</body>
</html>
