<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIP Access - Pro Sports</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap');

        :root { 
            --premium-purple: #7b61ff; 
            --bg-dark: #050505; 
            --card-glass: rgba(255, 255, 255, 0.03);
            --glow: rgba(123, 97, 255, 0.4);
        }

        body { 
            background-color: var(--bg-dark); 
            background-image: radial-gradient(circle at 50% 10%, #1a103d 0%, #050505 100%);
            color: white; 
            font-family: 'Poppins', sans-serif; 
            margin: 0; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            min-height: 100vh; 
            padding: 90px 15px 30px;
        }

        .navbar { 
            position: fixed; top: 0; left: 0; width: 100%; 
            background: rgba(0, 0, 0, 0.7); 
            backdrop-filter: blur(20px); 
            border-bottom: 1px solid rgba(255, 255, 255, 0.1); 
            padding: 15px 0; z-index: 1001; text-align: center; 
        }
        .navbar h1 { font-size: 1.2rem; margin: 0; font-weight: 800; color: var(--premium-purple); text-shadow: 0 0 10px var(--glow); }
        .navbar p { color: #888; font-size: 0.65rem; margin-top: 3px; }

        .plan-grid { 
            display: grid; 
            grid-template-columns: repeat(2, 1fr); 
            gap: 15px; 
            width: 100%; 
            max-width: 400px; 
        }
        
        .plan-card { 
            background: var(--card-glass);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.08); 
            border-radius: 24px; 
            padding: 20px 15px; 
            position: relative;
            transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .plan-card:hover {
            border-color: var(--premium-purple);
            background: rgba(123, 97, 255, 0.05);
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.6);
        }

        .card-header { display: flex; align-items: center; gap: 6px; margin-bottom: 10px; }
        .card-header i { color: var(--premium-purple); font-size: 0.8rem; }
        .card-header span { font-size: 0.6rem; font-weight: 600; color: #888; letter-spacing: 1.5px; }

        .price-box { margin-bottom: 15px; }
        .price-box .amount { font-size: 1.8rem; font-weight: 800; color: #fff; display: block; }
        .price-box .sub { font-size: 0.7rem; color: #666; }
        
        .buy-btn { 
            background: linear-gradient(135deg, var(--premium-purple), #5a41e6);
            color: #fff; border: none; width: 100%; padding: 12px; border-radius: 14px; 
            font-weight: 700; cursor: pointer; margin-bottom: 15px; font-size: 0.7rem; 
            text-transform: uppercase; transition: 0.3s;
        }

        .buy-btn:active { transform: scale(0.95); }

        .feature-item { font-size: 0.65rem; color: #aaa; display: flex; align-items: center; gap: 8px; margin-bottom: 6px; }
        .feature-item i { color: var(--premium-purple); font-size: 0.7rem; }

        /* Modal Glassmorphism */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(8px); display: none; justify-content: center; align-items: center; z-index: 2000; }
        .modal-content { 
            background: #0f0f15; width: 85%; max-width: 340px; padding: 30px; border-radius: 28px; 
            border: 1px solid rgba(123, 97, 255, 0.3); box-shadow: 0 0 40px rgba(0,0,0,0.8);
        }
        .input-group label { font-size: 0.75rem; color: #aaa; margin-bottom: 6px; display: block; }
        .input-group input, .input-group select { 
            width: 100%; padding: 14px; background: #050505; border: 1px solid #222; 
            border-radius: 12px; color: white; margin-bottom: 15px; font-family: inherit;
        }
    </style>
</head>
<body>

    <div class="navbar">
        <h1>ðŸ‘‘ VIP PREDICTIONS</h1>
        <p id="geo-status">Detecting your region...</p>
    </div>

    <div id="plan-list" class="plan-grid"></div>

    <div id="pModal" class="modal">
        <div class="modal-content">
            <h3 style="margin:0 0 15px; text-align:center">Final Step</h3>
            <div id="adminInfo" style="background: rgba(123, 97, 255, 0.08); padding: 15px; border-radius: 15px; font-size: 0.8rem; margin-bottom: 20px; border: 1px dashed var(--premium-purple); text-align:center;"></div>
            
            <div class="input-group">
                <label>Choose Method</label>
                <select id="mth" onchange="updateUI()"></select>
            </div>
            <div class="input-group">
                <input type="text" id="mInfo" placeholder="Your Phone/Wallet Number">
            </div>
            <div class="input-group">
                <input type="text" id="trxId" placeholder="Transaction ID (TrxID)">
            </div>
            <button class="buy-btn" onclick="submitOrder()">ACTIVATE NOW</button>
            <button style="background:none; border:none; color:#555; width:100%; font-size:0.7rem; cursor:pointer" onclick="closeModal()">Cancel</button>
        </div>
    </div>

    <script>
        const S_URL = 'https://cclfxvmpgkytzebuhwpj.supabase.co';
        const S_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNjbGZ4dm1wZ2t5dHplYnVod3BqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE5MDUyNTIsImV4cCI6MjA4NzQ4MTI1Mn0.-x_bxezKwaiJBdkTrJaXJuN95614sTHvTR3oBP_aLZQ';
        const _supabase = window.supabase.createClient(S_URL, S_KEY);

        const ADMIN_WALLETS = {
            bKash: "017XXXXXXXX (Personal)",
            Nagad: "018XXXXXXXX (Personal)",
            USDT: "T9zBxxxxxxxxxxxxxxxxx (TRC20)"
        };

        let selectedPlan = {};
        let isLocal = true;
        let userEmail = "guest@user.com";

        // à§§. à¦‡à¦‰à¦œà¦¾à¦° à¦ªà§à¦°à§‹à¦«à¦¾à¦‡à¦² à¦“ à¦¦à§‡à¦¶ à¦¶à¦¨à¦¾à¦•à§à¦¤à¦•à¦°à¦£ à¦²à¦œà¦¿à¦•
        async function initPage() {
            const { data: { session } } = await _supabase.auth.getSession();
            if (session) userEmail = session.user.email;

            try {
                const res = await fetch('https://ipapi.co/json/');
                const data = await res.json();
                isLocal = (data.country_code === 'BD');
                document.getElementById('geo-status').innerText = isLocal ? "Region: Bangladesh (à§³)" : "Region: International ($)";
            } catch(e) { isLocal = true; }
            
            loadPlans();
        }

        async function loadPlans() {
            const { data: plans, error } = await _supabase.from('subscription_plans').select('*').eq('is_active', true);
            if (error) return;

            document.getElementById('plan-list').innerHTML = plans.map(p => {
                const symbol = isLocal ? 'à§³' : '$';
                const price = isLocal ? p.price_bdt : p.price_usd;
                return `
                    <div class="plan-card">
                        <div class="card-header"><i class="fas fa-crown"></i><span>VIP PLAN</span></div>
                        <div class="price-box">
                            <span class="amount">${symbol}${price}</span>
                            <span class="sub">${p.duration_days} Days Access</span>
                        </div>
                        <button class="buy-btn" onclick="openModal('${p.plan_name}', ${p.duration_days}, '${symbol}${price}')">GET VIP</button>
                        <div class="feature-item"><i class="fas fa-bolt"></i> Instant Tips</div>
                        <div class="feature-item"><i class="fas fa-shield-alt"></i> Safe Win</div>
                    </div>`;
            }).join('');
        }

        function openModal(name, days, price) {
            selectedPlan = { name, days, price };
            const mth = document.getElementById('mth');
            mth.innerHTML = isLocal ? `<option value="bKash">bKash</option><option value="Nagad">Nagad</option>` : `<option value="USDT">USDT (TRC20)</option>`;
            updateUI();
            document.getElementById('pModal').style.display = 'flex';
        }

        function updateUI() {
            const method = document.getElementById('mth').value;
            document.getElementById('adminInfo').innerHTML = `Send <b>${selectedPlan.price}</b> to:<br><span style="color:var(--premium-purple); font-size:0.9rem">${ADMIN_WALLETS[method]}</span>`;
        }

        function closeModal() { document.getElementById('pModal').style.display = 'none'; }

        async function submitOrder() {
            const contact = document.getElementById('mInfo').value;
            const trx = document.getElementById('trxId').value;
            if(!contact || !trx) { Swal.fire('Error', 'Please fill all details', 'error'); return; }

            const { error } = await _supabase.from('payment_requests').insert([{
                user_email: userEmail,
                mobile: contact,
                plan_name: selectedPlan.name,
                duration: selectedPlan.days,
                amount: selectedPlan.price,
                payment_method: document.getElementById('mth').value,
                currency: isLocal ? 'BDT' : 'USDT',
                transaction_id: trx,
                status: 'pending'
            }]);

            if(!error) {
                Swal.fire('Success', 'Payment submitted! Access will be active shortly.', 'success')
                .then(() => location.reload());
            } else {
                Swal.fire('Error', error.message, 'error');
            }
        }

        initPage();
    </script>
</body>
</html>
