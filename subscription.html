<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIP Access - Pro Sports</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --neon: #00ff88; --bg: #020617; --card: #0f172a; --text-gray: #94a3b8; }
        body { background-color: var(--bg); color: white; font-family: 'Inter', sans-serif; margin: 0; padding: 15px; display: flex; flex-direction: column; align-items: center; }
        
        /* Grid & Card Styling */
        .plan-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 12px; width: 100%; max-width: 800px; margin-top: 20px; }
        .plan-card { background: var(--card); border: 1px solid rgba(255, 255, 255, 0.05); border-radius: 18px; padding: 15px; text-align: center; transition: 0.3s; }
        .plan-card:hover { border-color: var(--neon); transform: translateY(-5px); }
        .price-box .amount { font-size: 1.8rem; font-weight: 800; color: white; }
        .buy-btn { background: var(--neon); color: black; border: none; width: 100%; padding: 10px; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 10px; }

        /* Payment Modal Styling */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.95); backdrop-filter: blur(10px); display: none; justify-content: center; align-items: center; z-index: 1000; padding: 15px; }
        .modal-content { background: #111827; width: 100%; max-width: 360px; padding: 25px; border-radius: 25px; border: 1px solid #334155; }
        
        .admin-number-box { background: rgba(0, 255, 136, 0.1); border: 1px dashed var(--neon); padding: 12px; border-radius: 12px; margin: 15px 0; font-size: 0.85rem; }
        .admin-number-box span { color: var(--neon); font-weight: bold; font-size: 1rem; }

        .input-group { text-align: left; margin-bottom: 15px; }
        .input-group label { font-size: 0.75rem; color: var(--text-gray); margin-bottom: 5px; display: block; }
        .input-group input, .input-group select { width: 100%; padding: 12px; background: #020617; border: 1px solid #334155; border-radius: 10px; color: white; box-sizing: border-box; }
    </style>
</head>
<body>

    <div style="text-align:center">
        <h1 style="color:var(--neon); margin:0">VIP MEMBERSHIP</h1>
        <p style="color:var(--text-gray); font-size:0.8rem">Send payment and paste TrxID to activate</p>
    </div>

    <div id="plan-list" class="plan-grid"></div>

    <div id="pModal" class="modal">
        <div class="modal-content">
            <h3 style="margin:0">Payment Checkout</h3>
            
            <div class="admin-number-box" id="adminInfo">
                </div>

            <div class="input-group">
                <label>Select Method</label>
                <select id="mth" onchange="updateAdminInfo()"></select>
            </div>

            <div class="input-group">
                <label id="phoneLabel">Your Number</label>
                <input type="text" id="mInfo" placeholder="e.g. 017XXXXXXXX">
            </div>

            <div class="input-group">
                <label>Transaction ID (TrxID)</label>
                <input type="text" id="trxId" placeholder="Paste TrxID here">
            </div>

            <button class="buy-btn" onclick="submitOrder()">SUBMIT PAYMENT REQUEST</button>
            <p onclick="closeModal()" style="font-size:0.75rem; color:var(--text-gray); margin-top:15px; cursor:pointer; text-align:center">Cancel</p>
        </div>
    </div>

    <script>
        const S_URL = 'https://cclfxvmpgkytzebuhwpj.supabase.co';
        const S_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNjbGZ4dm1wZ2t5dHplYnVod3BqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE5MDUyNTIsImV4cCI6MjA4NzQ4MTI1Mn0.-x_bxezKwaiJBdkTrJaXJuN95614sTHvTR3oBP_aLZQ';
        const _supabase = window.supabase.createClient(S_URL, S_KEY);

        // আপনার পার্সোনাল পেমেন্ট নাম্বার এখানে সেট করুন
        const ADMIN_NUMBERS = {
            bKash: "017XXXXXXXX (Personal)",
            Nagad: "018XXXXXXXX (Personal)",
            USDT: "T9zBxxxxxxxxYourWalletAddress",
            BTC: "bc1qxxxxxxxxYourBTCAddress"
        };

        let selectedPlan = {};
        let isLocal = true;

        async function init() {
            try {
                const res = await fetch('https://ipapi.co/json/');
                const data = await res.json();
                isLocal = (data.country_code === 'BD');
            } catch(e) { isLocal = true; }
            loadPlans();
        }

        async function loadPlans() {
            const { data: plans } = await _supabase.from('subscription_plans').select('*').eq('is_active', true).order('duration_days', { ascending: true });
            const list = document.getElementById('plan-list');
            if (plans) {
                list.innerHTML = plans.map(p => {
                    const symbol = isLocal ? '৳' : '$';
                    const price = isLocal ? (p.duration_days * 100) : (p.duration_days * 1.5);
                    return `
                        <div class="plan-card">
                            <div style="font-size:0.6rem; color:var(--neon)">${p.duration_days} DAYS</div>
                            <div style="font-size:1rem; font-weight:700; margin:5px 0">${p.plan_name}</div>
                            <div class="price-box"><span class="amount">${symbol}${price}</span></div>
                            <button class="buy-btn" onclick="openModal('${p.plan_name}', ${p.duration_days}, '${symbol}${price}')">ACTIVATE</button>
                        </div>
                    `;
                }).join('');
            }
        }

        function openModal(name, days, price) {
            selectedPlan = { name, days, price };
            const mth = document.getElementById('mth');
            mth.innerHTML = isLocal ? 
                `<option value="bKash">bKash</option><option value="Nagad">Nagad</option>` : 
                `<option value="USDT">USDT (TRC20)</option><option value="BTC">Bitcoin</option>`;
            
            updateAdminInfo();
            document.getElementById('pModal').style.display = 'flex';
        }

        function updateAdminInfo() {
            const method = document.getElementById('mth').value;
            const infoBox = document.getElementById('adminInfo');
            const phoneLabel = document.getElementById('phoneLabel');
            
            infoBox.innerHTML = `Send <span>${selectedPlan.price}</span> to this ${method} number:<br><span>${ADMIN_NUMBERS[method]}</span>`;
            phoneLabel.innerText = isLocal ? "Your Mobile Number" : "Your Wallet/Email";
        }

        function closeModal() { document.getElementById('pModal').style.display = 'none'; }

        async function submitOrder() {
            const userMobile = document.getElementById('mInfo').value;
            const userTrx = document.getElementById('trxId').value;
            const method = document.getElementById('mth').value;

            if(!userMobile || !userTrx) return alert("সবগুলো তথ্য সঠিকভাবে দিন!");

            const { data: { session } } = await _supabase.auth.getSession();
            const email = session?.user?.email || "guest@user.com";

            // ডাটাবেসে সেভ করা
            const { error } = await _supabase.from('payment_requests').insert([{
                user_email: email,
                mobile: userMobile,
                plan_name: selectedPlan.name,
                duration: selectedPlan.days,
                amount: selectedPlan.price,
                payment_method: method,
                currency: isLocal ? 'BDT' : 'USDT',
                status: userTrx // আমরা TrxID টিকে status কলামে অথবা নতুন ট্রানজেকশন কলামে রাখতে পারি
            }]);

            if(!error) { alert("Success! Admin will verify your TrxID: " + userTrx); closeModal(); }
        }

        init();
    </script>
</body>
</html>
