<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIP Predictions | Sports Pro</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { background: #0f172a; color: white; font-family: sans-serif; }
        .match-card { background: #1e293b; padding: 20px; margin: 15px; border-radius: 12px; position: relative; border: 1px solid #334155; }
        .blur-text { filter: blur(6px); user-select: none; margin: 10px 0; background: #0f172a; padding: 10px; border-radius: 5px; }
        .lock-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: rgba(15, 23, 42, 0.6); }
        .btn-unlock { background: #00ff88; color: #000; border: none; padding: 10px 20px; border-radius: 5px; font-weight: bold; cursor: pointer; }
        header, footer { display: none; } /* শুরুতে হাইড থাকবে */
    </style>
</head>
<body>

<header id="main-header"> </header>

<div class="container">
    <h2 style="text-align: center; color: #00ff88; margin-top: 20px;">Premium VIP Predictions</h2>
    <div id="vip-list"> </div>
</div>

<footer id="main-footer"> </footer>

<script>
    const S_URL = 'https://cclfxvmpgkytzebuhwpj.supabase.co';
    const S_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNjbGZ4dm1wZ2t5dHplYnVod3BqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE5MDUyNTIsImV4cCI6MjA4NzQ4MTI1Mn0.-x_bxezKwaiJBdkTrJaXJuN95614sTHvTR3oBP_aLZQ';
    const _supabase = window.supabase.createClient(S_URL, S_KEY);

    async function checkUserAndLoad() {
        const { data: { session } } = await _supabase.auth.getSession();
        let isVip = false;

        if (session) {
            // শর্ত ৮: একাউন্ট থাকলে হেডার-ফুটার দেখাবে
            document.getElementById('main-header').style.display = 'block';
            document.getElementById('main-footer').style.display = 'block';

            // শর্ত ৩ ও ৭: VIP স্ট্যাটাস ও এক্সপায়ারি চেক
            const { data: profile } = await _supabase.from('profiles').select('*').eq('id', session.user.id).single();
            if (profile && profile.is_vip && new Date(profile.expiry_date) > new Date()) {
                isVip = true;
            }
        }

        const { data: matches } = await _supabase.from('vip_matches').select('*');
        const list = document.getElementById('vip-list');

        list.innerHTML = matches.map(m => `
            <div class="match-card">
                <h3>${m.match_name}</h3>
                <div class="${isVip ? '' : 'blur-text'}">
                    <strong>Prediction:</strong> ${isVip ? m.description : 'This content is hidden for non-vip members. Please unlock to see.'}
                </div>
                ${!isVip ? `<div class="lock-overlay"><button class="btn-unlock" onclick="handleUnlock(${!!session})">Unlock Now</button></div>` : ''}
            </div>
        `).join('');
    }

    function handleUnlock(isLoggedIn) {
        if (!isLoggedIn) {
            // শর্ত ২: একাউন্ট না থাকলে লগইন পেজে পাঠাবে
            window.location.href = 'login.html';
        } else {
            // শর্ত ৪: একাউন্ট আছে কিন্তু VIP না হলে সাবস্ক্রিপশন পেজে পাঠাবে
            window.location.href = 'subscription.html';
        }
    }

    window.onload = checkUserAndLoad;
</script>
</body>
</html>
